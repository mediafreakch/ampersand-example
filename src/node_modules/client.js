var domready = require('domready');
var AppView = require('app/app');
var Router = require('router');

module.exports = {
  // main app initialiser
  blastoff: function() {
    var that = window.app = this;
    this.router = new Router();
    domready(function() {
      // init our app view
      var appView = that.view = new AppView({
        el: document.body
      });

      // ...and render it
      appView.render();
      // we have what we need, we can now start our router
      // and show the appropriate page
      that.router.history.start({
        pushState: true,
        root: '/'
      });
    })
  },
  // This is how you navigate around the app.
  // this gets called by a global click handler that handles
  // all the <a> tags in the app.
  // it expects a url without a leading slash.
  // for example: "costello/settings".
  navigate: function(page) {
    var url = (page.charAt(0) === '/') ? page.slice(1) : page;
    this.router.history.navigate(url, {
      trigger: true
    });
  }
};

// run it
module.exports.blastoff();
